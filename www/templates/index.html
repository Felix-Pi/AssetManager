{% extends "base/base.html" -%}
{% block content -%}


<div class="row row-cols-1" id="top_steps">

    <div class="col-md-3 mb-4">
        <div class="ui steps">
            <div class="step">
                <div class="content">
                    <div class="description">{{ all_portfolios['profit_today_absolute'] }} €</div>
                    <div class="title">Performance today</div>
                </div>
                <div class="ordered_step_number">{{ all_portfolios['profit_today_relative'] }} %</div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="ui steps">
            <div class="step">
                <div class="content">
                    <div class="description">{{ all_portfolios['profit_total_absolute'] }} €</div>
                    <div class="title"> overall return</div>
                </div>
                <div class="ordered_step_number">{{ all_portfolios['profit_total_relative'] }} %</div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="ui steps">
            <div class="step">
                <div class="content">
                    <div class="description">&nbsp;</div>
                    <div class="title">portfolio value</div>
                </div>
                <div class="ordered_step_number"> {{ all_portfolios['value'] }} €</div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="ui steps">
            <div class="step">
                <div class="content">
                    <div class="description"> &nbsp;</div>
                    <div class="title">dividends</div>
                </div>
                <div class="ordered_step_number"> {{ all_portfolios['dividend'] }} €</div>
            </div>
        </div>
    </div>


</div>

<div class="row row-cols-1">

    <!-- table portfolios -->
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body" style="padding: 0;">
                <table class="table">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">Portfolio</th>
                        <th scope="col" id="profit_label_title">profit total</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for portfolio in portfolios %}
                    <tr>
                        <th scope="row">


                            <h1 class="ui sub header">
                                <a href="{{ url_for('portfolio') }}?id={{ portfolio.id }}">{{ portfolio.title
                                    }}</a>
                            </h1>
                            <span>
                            <div class="ui label">
                                {{ portfolio.portfolio_value }}
                            </div>
            </span>
                        </th>

                        <td>

                            <span class="profit_label" counter="0"
                                  data-val="{{ portfolio.profit_total_absolute }}~{{ portfolio.profit_total_relative }}~{{ portfolio.profit_today_absolute }}~{{ portfolio.profit_today_relative }}">
                            {% if portfolio.profit_total_absolute >= 0 %}
                            <div class="ui label green">
                                <i class="fas fa-caret-up"></i> <span>{{ portfolio.profit_total_absolute }}</span>
                            </div>
                            {% else %}
                            <div class="ui label red">
                                <i class="fas fa-caret-down"></i> <span>{{ portfolio.profit_total_absolute }}</span>

                            </div>
                            {% endif %}
                             </span>
                        </td>


                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- line chart -->
    <div class="col-md-6 mb-4">
        <div class="card" id="linechart_all_portfolios" data-val="{{doughnut_asset_allocation_data}}"
             label-val="{{doughnut_asset_allocation_label}}">
            <div class="card-header"></div>

            <div class="card-body"></div>
        </div>
    </div>


    <!-- doughnut -->
    <div class="col-md-3 mb-4">
        <div class="card" id="doughnut_asset_allocation" data-val="{{doughnut_asset_allocation_data}}"
             label-val="{{doughnut_asset_allocation_label}}">
            <div class="card-header"></div>

            <div class="card-body"></div>
        </div>
    </div>
</div>


<div class="row row-cols-2">

    <!-- filler -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">filler</div>
            <div class="card-body"></div>

        </div>
    </div>

    <!-- news -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">News</div>
            <div class="card-body">
                {% include "newsfeed.html" %}
            </div>
        </div>
    </div>
</div>


{%- endblock content %}


{% block footer -%}
<script>

    doughnut_asset_allocation_data = JSON.parse($('#doughnut_asset_allocation').attr('data-val').replaceAll('\'', '\"'))
    doughnut_asset_allocation_label = JSON.parse($('#doughnut_asset_allocation').attr('label-val').replaceAll('\'', '\"'))

    chart_doughnut('#doughnut_asset_allocation', 'Distrubution', doughnut_asset_allocation_data, doughnut_asset_allocation_label, '€', 'auto', 300)

    data = []
    data.append({'title': 'Stock1', 'data': doughnut_sector_data})
    data.append({'title': 'Stock2', 'data': portfolio_assets_doughnut_data})
    chart_linechart('#linechart_all_portfolios', 'Portfolios', data, doughnut_sector_label)

</script>
{%- endblock footer %}